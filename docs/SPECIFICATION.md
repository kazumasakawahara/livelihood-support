# 生活保護受給者尊厳支援システム 仕様書

**文書番号**: SPEC-LVS-2024-001
**バージョン**: 2.0
**作成日**: 2024年12月28日
**ステータス**: ドラフト

---

## 1. 概要

### 1.1 目的

本仕様書は、生活保護受給者を「尊厳ある個人」として支援するためのデータベースシステムを、セキュリティとプライバシーを最優先に再構築するための要件を定義する。

### 1.2 スコープ

- データ入力・構造化サブシステム
- データ分析・相談サブシステム
- セキュリティ・認証基盤
- 監査・コンプライアンス機能

### 1.3 用語定義

| 用語 | 定義 |
|------|------|
| 受給者 | 生活保護を受給している個人 |
| CW | ケースワーカー（福祉事務所職員） |
| SV | スーパーバイザー（査察指導員） |
| PII | 個人識別情報（Personally Identifiable Information） |
| 要配慮個人情報 | 病歴、障害、犯罪歴等の特に配慮を要する情報 |

---

## 2. システム要件

### 2.1 機能要件

#### FR-001: ユーザー認証・認可

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-001-01 | システムはLDAP/Active Directory連携による認証をサポートすること | 必須 |
| FR-001-02 | 多要素認証（MFA）をサポートすること | 必須 |
| FR-001-03 | ロールベースアクセス制御（RBAC）を実装すること | 必須 |
| FR-001-04 | セッションタイムアウト（30分）を実装すること | 必須 |
| FR-001-05 | 同一ユーザーの重複ログインを検知・制御すること | 推奨 |

#### FR-002: ケース記録管理

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-002-01 | ケース記録の作成・読取・更新機能を提供すること | 必須 |
| FR-002-02 | ケース記録の削除は論理削除とし、物理削除は管理者のみ可能とすること | 必須 |
| FR-002-03 | ケース記録の変更履歴を保持すること | 必須 |
| FR-002-04 | ファイル添付機能（画像、PDF）をサポートすること | 推奨 |
| FR-002-05 | テンプレートベースの記録入力をサポートすること | 推奨 |

#### FR-003: AI支援機能

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-003-01 | ケース記録のAI構造化はオンプレミスLLMで処理すること | 必須 |
| FR-003-02 | 外部AIへのデータ送信時は匿名化処理を必須とすること | 必須 |
| FR-003-03 | AI処理への同意取得・管理機能を提供すること | 必須 |
| FR-003-04 | AI生成内容には明確なラベル付けをすること | 必須 |
| FR-003-05 | 訪問前ブリーフィング生成機能を提供すること | 推奨 |
| FR-003-06 | 類似ケース検索機能を提供すること | 推奨 |

#### FR-004: 二次被害防止

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-004-01 | NgApproach（避けるべき関わり方）の登録・表示機能を提供すること | 必須 |
| FR-004-02 | 訪問前にNgApproachを自動警告すること | 必須 |
| FR-004-03 | 批判的指導の検知・警告機能を提供すること | 必須 |
| FR-004-04 | 緊急時安全情報の即座表示機能を提供すること | 必須 |

#### FR-005: 多機関連携

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-005-01 | ケース会議記録の管理機能を提供すること | 必須 |
| FR-005-02 | 情報共有の同意状況を管理すること | 必須 |
| FR-005-03 | 外部機関との連携履歴を記録すること | 必須 |
| FR-005-04 | 引き継ぎサマリー生成機能を提供すること | 推奨 |

#### FR-006: 監査・コンプライアンス

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-006-01 | 全操作の監査ログを記録すること | 必須 |
| FR-006-02 | 監査ログは改ざん不可能な形式で保存すること | 必須 |
| FR-006-03 | 監査ログの検索・エクスポート機能を提供すること | 必須 |
| FR-006-04 | 定期的なアクセスレビューレポートを生成すること | 推奨 |

---

### 2.2 非機能要件

#### NFR-001: セキュリティ

| ID | 要件 | 基準値 |
|----|------|--------|
| NFR-001-01 | 保存データの暗号化 | AES-256-GCM |
| NFR-001-02 | 通信の暗号化 | TLS 1.3 |
| NFR-001-03 | パスワードハッシュ | bcrypt (cost=12) |
| NFR-001-04 | APIキー・認証情報の保護 | シークレット管理システム使用 |
| NFR-001-05 | 脆弱性対応 | 重大: 24時間以内、高: 7日以内 |

#### NFR-002: 可用性

| ID | 要件 | 基準値 |
|----|------|--------|
| NFR-002-01 | システム稼働率 | 99.5% 以上（計画停止除く） |
| NFR-002-02 | 計画停止通知 | 72時間前 |
| NFR-002-03 | 障害復旧時間（RTO） | 4時間以内 |
| NFR-002-04 | データ復旧ポイント（RPO） | 1時間以内 |

#### NFR-003: 性能

| ID | 要件 | 基準値 |
|----|------|--------|
| NFR-003-01 | ページ表示時間 | 3秒以内 |
| NFR-003-02 | 検索応答時間 | 5秒以内 |
| NFR-003-03 | AI処理応答時間 | 30秒以内 |
| NFR-003-04 | 同時接続ユーザー数 | 50ユーザー |

#### NFR-004: 保守性

| ID | 要件 | 基準値 |
|----|------|--------|
| NFR-004-01 | ログ保持期間 | 監査ログ: 7年、アプリログ: 1年 |
| NFR-004-02 | バックアップ頻度 | 日次フル、時間毎増分 |
| NFR-004-03 | バックアップ保持期間 | 日次: 30日、月次: 1年 |

---

## 3. データモデル

### 3.1 7本柱データモデル（Version 2.0）

```
┌─────────────────────────────────────────────────────────────────┐
│                     Client（受給者）                             │
│  - client_id (UUID)                                             │
│  - created_at, updated_at                                       │
│  - consent_status (AI処理同意状況)                              │
└─────────────────────────────────────────────────────────────────┘
         │
         ├──→ [第1の柱] CaseRecord（ケース記録）
         │      - record_id, narrative, recorded_by, recorded_at
         │      - is_ai_structured (AI構造化フラグ)
         │      - version (変更履歴管理)
         │
         ├──→ [第2の柱] ClientProfile（本人像）
         │      - strengths, challenges, preferences
         │      - extracted_by (human/ai)
         │
         ├──→ [第3の柱] CareWisdom（関わりの知恵）
         │      ├─→ EffectiveApproach（効果的アプローチ）
         │      └─→ NgApproach（禁忌アプローチ）★最重要
         │
         ├──→ [第4の柱] ApplicationHistory（申告歴）
         │
         ├──→ [第5の柱] SocialNetwork（社会的ネットワーク）
         │      - family, community, organizations
         │      - exploitation_risk (搾取リスクフラグ)
         │
         ├──→ [第6の柱] LegalFramework（法的基盤）
         │      - applicable_programs, rights, limitations
         │
         └──→ [第7の柱] SafetyAndCollaboration（安全と連携）
                ├─→ FinancialSafety（金銭的安全）
                ├─→ CaseConference（ケース会議）
                └─→ AgencyCollaboration（機関連携）
```

### 3.2 セキュリティ関連エンティティ

```
┌─────────────────────────────────────────────────────────────────┐
│ User（システムユーザー）                                        │
│  - user_id, username, password_hash                             │
│  - role (CW / SV / Admin / ReadOnly)                            │
│  - mfa_enabled, last_login                                      │
└─────────────────────────────────────────────────────────────────┘
         │
         ├──→ AuditLog（監査ログ）
         │      - log_id, user_id, action, target_entity
         │      - timestamp, ip_address, user_agent
         │      - before_value, after_value (変更内容)
         │
         ├──→ Session（セッション）
         │      - session_id, user_id, created_at, expires_at
         │      - ip_address, is_active
         │
         └──→ AccessGrant（アクセス権限）
                - user_id, client_id, permission_level
                - granted_by, granted_at, expires_at
```

---

## 4. ユーザーロールと権限

### 4.1 ロール定義

| ロール | 説明 | 略称 |
|--------|------|------|
| ケースワーカー | 担当ケースの記録・閲覧 | CW |
| スーパーバイザー | 所属係の全ケース閲覧・承認 | SV |
| 管理者 | システム設定・ユーザー管理 | Admin |
| 閲覧専用 | 統計情報のみ閲覧可能 | ReadOnly |

### 4.2 権限マトリクス

| 機能 | CW | SV | Admin | ReadOnly |
|------|:--:|:--:|:-----:|:--------:|
| 担当ケース閲覧 | ✓ | ✓ | ✓ | - |
| 担当ケース編集 | ✓ | ✓ | ✓ | - |
| 係内ケース閲覧 | - | ✓ | ✓ | - |
| 全ケース閲覧 | - | - | ✓ | - |
| NgApproach登録 | ✓ | ✓ | ✓ | - |
| AI機能利用 | ✓ | ✓ | ✓ | - |
| ユーザー管理 | - | - | ✓ | - |
| 監査ログ閲覧 | - | ✓ | ✓ | - |
| 統計レポート | - | ✓ | ✓ | ✓ |
| システム設定 | - | - | ✓ | - |

---

## 5. 外部インターフェース

### 5.1 ユーザーインターフェース

| UI | 技術 | 用途 |
|----|------|------|
| データ入力アプリ | Streamlit + 認証 | ケース記録入力 |
| 管理コンソール | Web (React/Vue) | 設定・監査 |
| 対話インターフェース | Claude Desktop + MCP | 分析・相談 |

### 5.2 システムインターフェース

| インターフェース | プロトコル | 認証方式 |
|-----------------|-----------|----------|
| Neo4j Database | Bolt over TLS | 証明書認証 |
| ローカルLLM | HTTP/gRPC | API Key + IP制限 |
| MCP Server | stdio/SSE | OAuth 2.0 |
| LDAP/AD | LDAPS | サービスアカウント |

---

## 6. 制約条件

### 6.1 法的制約

- 個人情報保護法の遵守
- 生活保護法に基づく記録保存義務（5年間）
- 自治体情報セキュリティポリシーの遵守

### 6.2 技術的制約

- 外部クラウドへの個人情報送信禁止（自治体ポリシー）
- オンプレミス環境での運用
- 既存システムとのデータ連携（将来）

### 6.3 運用制約

- 24時間365日の無人運転は想定しない
- 計画停止は業務時間外に実施

---

## 7. 受入基準

### 7.1 機能テスト

- 全機能要件の100%カバレッジ
- 異常系テストの実施
- ユーザー受入テスト（UAT）の合格

### 7.2 セキュリティテスト

- 脆弱性診断（OWASP Top 10）
- ペネトレーションテスト
- 認証・認可テスト

### 7.3 性能テスト

- 負荷テスト（同時50ユーザー）
- 長時間運転テスト（72時間）

---

## 8. 改訂履歴

| バージョン | 日付 | 変更内容 | 承認者 |
|-----------|------|----------|--------|
| 1.0 | - | 初版作成 | - |
| 2.0 | 2024-12-28 | セキュリティ要件追加、再構築版 | - |

---

**文書終了**
